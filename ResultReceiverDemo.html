<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="icon" type="image/png" href="images/favicon.png" />
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <title>Androiddev by ramdroid</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>ResultReceiver</h1>
        <h2>Receive results from a service</h2>

	<a href="index.html" class="btn btn-home"><span class="icon"></span>Home</a>
	<a href="contact.html" class="btn btn-contact"><span class="icon"></span>Contact</a>

      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h3>Problem</h3>

<p>When running a <code>Service</code> you might want to send back some results to the calling <code>Activity</code>.</p>

<p>In order to achieve this you could use multiple broadcasts (which adds some unneccessary complexity)
or cheat around with static variables in the service object (very bad idea).</p>

<p><i><small>The problem could also be solved by using a 3rd party library (like for instance EventBus) but
explaining why I don't want to do this goes beyond this little tutorial.</small></i></p>

<h3>Solution</h3>

<p>The documentation says <code>ResultReceiver</code> is a <i>Generic interface for receiving a callback result from someone.</i></p>

<p>This is exactly what we need! First we implement the <code>Activity</code> that attaches a <code>ResultReceiver</code> object to the start intent:</p>

<pre><code>Intent i = new Intent(this, SomeService.class);
i.putExtra(SomeService.EXTRA, new ResultReceiver(handler) {
    @Override
    protected void onReceiveResult(int resultCode, Bundle resultData) {
        // here we receive the result
    }
});
startService(i);
</code></pre>

<p>Notice the <code>handler</code> parameter in the <code>ResultReceiver</code> constructor:</p>

<p>Usually your service code is executed in a background thread and accordingly the result would be fired from the same thread. 
By adding this handler you make sure you always receive the result back in the UI thread.

<p>In the next step we implement the <code>Service</code> code that fires back a result:</p>

<pre><code>ResultReceiver resultReceiver = intent.getParcelableExtra(EXTRA);
Bundle resultData = new Bundle();
resultData.putString("result", "This is some text.");
resultReceiver.send(RESULT, resultData);
</code></pre>

<p>That's it! Isn't this a nice and elegant way?</p>

<h3>Handling multiple actions</h3>

<p>If you need to handle multiple actions then this still can be done fairly easily.</p>

<p>In the activity this is just as simple as sending a broadcast to the service:</p>

<pre><code>Intent i = new Intent(SomeService.ACTION_SEND_SOMETHING);
i.putExtra("parameter", 42);
sendBroadcast(i);
</code></pre>

<p>In the service you register the broadcast receiver:</p>

<pre><code>IntentFilter filter = new IntentFilter();
filter.addAction(ACTION_SEND_SOMETHING);
SomeReceiver receiver = new SomeReceiver();
registerReceiver(receiver, filter);
</code></pre>
        
<p>And in onReceive you send back the result:</p>

<pre><code>private class SomeReceiver extends BroadcastReceiver {
    @Override
    public void onReceive(final Context context, Intent intent) {
        // send back result
        Bundle resultData = new Bundle();
        resultData.putString("result", "Here's the result");
        resultReceiver.send(DATA, resultData);
    }
}
</code></pre>

<p>Keep in mind that you should return from this callback as quickly as possible. The idea here is that
you only check some status in the service or add some data into a queue for later processing.</p>

<h3>Sample code</h3>

<p>Check out the full sample project on Github! Fork and send me a pull request if you want to contribute...</p>

      <a href="https://github.com/ramdroid/androiddev/tree/master/ResultReceiverDemo" class="btn btn-github" target="_blank">
        <span class="icon"></span>View sample</a>

      <a href="http://developer.android.com/reference/android/os/ResultReceiver.html" class="btn btn-android" target="_blank">
        <span class="icon"></span>Reference API</a>

    </section>
    </div>

    
  </body>
</html>
